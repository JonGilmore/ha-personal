{% macro events(days) %}
    {% set sensors = states.sensor
    | rejectattr('state', 'in', ['unavailable', 'unknown'])
    | selectattr('attributes.unit_of_measurement', 'defined')
    | selectattr('attributes.unit_of_measurement', '==', 'Days')
    | list
    %}
    {% set low = sensors | map(attribute='state') | map('int') | select('<=', days) | map('string') | list %}
    {{ sensors | selectattr('state', 'in', low) | map(attribute='entity_id') | list }}
{% endmacro %}
